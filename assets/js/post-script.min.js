var next=$("#next");var previous=$("#previous");var buttonsLetter=$("#alphabet").find("> a");var container=$("#mainContentAjax");var loader=$("#mainContentAjaxLoader");var menu_btn=$("#menu-btn");var home_btn=$("#home-btn");var add_btn=$("#add");var pwr_btn=$("#power");var dropdownModal=$("#dropdownModal");var box_size_x=170;var box_size_y=170;var request="type=all";var sort_by="1";var search_field="artist";var show,show_x,show_y;var answer_to_life_universe_and_everything=42;var page=1;var imageSelector={albumArtist:false,to:null,from:null,imageUrl:null,open:function(){openModalPage("assets/modals/image_picker/")},back:function(){openModalPage(this.from)},done:function(){openModalPage(this.to)}};function reload(){var full_request="assets/php/get_albums.php?"+request+"&page="+page+"&x="+show_x+"&y="+show_y+"&orderBy="+sort_by;$.ajax({url:full_request,contentType:"text/html;charset=utf8"}).done(function(response,status,xhr){var re=/<!--(.*)-->$/;var m;if((m=re.exec(response))!==null){if(m.index===re.lastIndex){re.lastIndex++}}var json_response=$.parseJSON(m[1]);if(json_response.code===1){alert("No albums found matching the search criteria.")}else{if(json_response.isLastPage){next.hide()}else{next.show()}if(json_response.isFirstPage){previous.hide()}else{previous.show()}loader.fadeOut(animation_medium,function(){loader.html(response);$(".album:not(.filler)").click(function(){var detected_id=$(this).attr("id");openModalPage("assets/modals/album_details.php?id="+detected_id)});$(".album .moar").click(function(e){var detected_id=$(this).parent().attr("id");changeAlbum(detected_id);e.stopPropagation()})});divH=divW=0;var element=$("#mainContentAjax").find("td");divW=element.width();divH=element.height();function checkResize(){element=$("#mainContentAjax").find("td");var w=element.width();var h=element.height();if(w!=divW||h!=divH){element.height(0);element.width(0);element.height("100%");element.width("100%");divH=h;divW=w}}checkResize();loader.fadeIn()}})}function getHowManyAlbumsToShow(){var height=$(window).height()-container.offset().top;var width=$(window).width()-100;show_x=Math.round(width/box_size_x);var resto_x=width/box_size_x-show_x;show_y=Math.floor((height-resto_x*box_size_y)/box_size_y);if(show_y<2)show_y=2;if(show_x<3){show_x=5}show=show_x*show_y}function alphabet(value){page=1;request="type=alphabet&alphabet="+value;reload()}function search(value){page=1;request="type=search&searchField="+search_field+"&search="+value;reload()}function changeSearchField(value,div){page=1;$(".searchbox-icon.active").removeClass("active");div.addClass("active");search_field=value;search_input.focus()}function showDropdownMenu(){menu_btn.addClass("active");dropdownModal.offset({top:0})}function hideDropdownMenu(){menu_btn.removeClass("active");dropdownModal.css("top","-150px")}function toggleDropdownMenu(){if(dropdownModal.css("top")==="0px"){hideDropdownMenu()}else if(dropdownModal.css("top")==="-150px"){showDropdownMenu()}}next.click(function(){page++;reload()});previous.click(function(){if(page>1){page--;reload()}});menu_btn.click(function(){toggleDropdownMenu()});home_btn.click(function(){request="type=all";sort_by="1";search_field="title";page=1;$("#sorter").find(".by.active").removeClass("active");$("#sorter").find(".by:first-of-type").addClass("active");reload()});add_btn.click(function(){$.ajax("assets/php/prepare_upload.php");openModalPage("assets/modals/add_album/1.upload_album.php")});buttonsLetter.click(function(event){var letter=event.target.innerHTML;alphabet(letter)});pwr_btn.click(function(){$.ajax("assets/cmd/exec.php?cmd=shutdown")});$("#albumCover").click(function(){if(typeof album_id!=="undefined")openModalPage("assets/modals/album_details.php?id="+album_id)});previous.hide();$(document).ready(function(){getHowManyAlbumsToShow();reload()});$(document).mouseup(function(e){if(!dropdownModal.is(e.target)){hideDropdownMenu()}});$(window).bind("resize",function(e){window.resizeEvt;$(window).resize(function(){clearTimeout(window.resizeEvt);window.resizeEvt=setTimeout(function(){getHowManyAlbumsToShow();reload()},animation_short)})});